datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  name         String   // User display name (from OAuth or email)
  passwordHash String?  // Optional: keep for existing users, new users via OAuth
  googleId     String?  @unique
  githubId     String?  @unique
  provider     String?  // EMAIL, GOOGLE, GITHUB
  avatar       String?  // Avatar URL from OAuth
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Event {
  id        Int      @id @default(autoincrement())
  name      String
  ownerName String   // Owner's name (not foreign key - allows anonymous users)
  createdAt DateTime @default(now())
  members   Member[]
  
  @@index([ownerName])
}

model Member {
  id         Int      @id @default(autoincrement())
  username   String?  // User's name or anonymous identifier (nullable for offline members)
  eventId    Int
  lat        Float?
  lng        Float?
  address    String?
  travelMode String?  @default("driving") // driving, transit, walking, bicycling
  
  // For offline/anonymous members
  nickname   String?  // Display name for non-registered members
  isOffline  Boolean  @default(false)  // Flag to distinguish offline members
  
  event      Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  @@index([eventId])
  @@index([username])
}


